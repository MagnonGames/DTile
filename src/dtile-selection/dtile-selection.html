<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="dtile-selection">
	<template>
		<style>
			:host, #container {
				display: block;
				position: absolute;
				top: 0; right: 0; bottom: 0; left: 0;
				width: 100%;
				height: 100%;
				overflow: hidden;
				pointer-events: none;
			}

			#selection {
				position: absolute;
				background-color: var(--accent-color);
				opacity: 0;
				transition: opacity 0.15s ease-in-out;
			}
		</style>
		<div id="container">
			<span id="selection"></span>
		</div>
	</template>

	<script>
		Polymer({
			is: "dtile-selection",

			properties: {
				tapSelect: {
					type: Boolean,
					value: false,
					reflectToAttribute: true
				},
				selecting: {
					type: Boolean,
					value: false,
					reflectToAttribute: true,
					notify: true,
					readOnly: true
				},

				opacity: {
					type: Number,
					value: 0.5,
					reflectToAttribute: true
				}
			},

			get color() {
				const computedStyle = getComputedStyle(this.$.selection);
				return computedStyle.getPropertyValue("background-color");
			},

			startSelect(x, y) {
				this.selecting = true;
				this.startPosition = { x, y };
				this.$.selection.style.opacity = this.opacity;
			},

			updateSelect(x, y) {
				const rect = this._getSelectionRectangle(this.startPosition, { x, y });
				this.$.selection.style.left = `${rect.x}px`;
				this.$.selection.style.top = `${rect.y}px`;
				this.$.selection.style.width = `${rect.width}px`;
				this.$.selection.style.height = `${rect.height}px`;
			},

			endSelect(x, y) {
				this.selecting = false;
				this.$.selection.style.opacity = 0;

				const rect = this._getSelectionRectangle(this.startPosition, { x, y });
				return {
					min: { x: rect.x, y: rect.y },
					max: { x: rect.x + rect.width, y: rect.y + rect.height }
				};
			},

			_getSelectionRectangle(startPos, endPos) {
				const x = Math.min(startPos.x, endPos.x);
				const y = Math.min(startPos.y, endPos.y);
				const width = Math.max(startPos.x, endPos.x) - x;
				const height = Math.max(startPos.y, endPos.y) - y;
				return { x, y, width, height };
			}
		});
	</script>
</dom-module>
