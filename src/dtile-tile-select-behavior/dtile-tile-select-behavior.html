<script>
	window.DTile = window.DTile || {};

	// Note: to implement this behavior, you need to have a getTilePosition function that
	// takes in x, y (client positions) and returns { x, y } (tilemap positions)
	// and setTileSelected function that takes in x, y, color which you can do
	// whatever you want with.
	window.DTile.TileSelectBehavior = {
		properties: {
			currentSelection: {
				type: Array,
				value: [],
				readOnly: true,
				notify: true
			}
		},

		listeners: {
			select: "_handleSelect"
		},

		_handleSelect(e) {
			e.preventDefault();
			e.stopPropagation();

			if (e.detail.width === 0 && e.detail.height === 0) {
				this.changeSelection([]);
				return;
			}

			const endPos = { x: e.detail.x + e.detail.width, y: e.detail.y + e.detail.height };
			const tilePos1 = this.getTilePosition(e.detail.x, e.detail.y);
			const tilePos2 = this.getTilePosition(endPos.x, endPos.y);

			const selectionArray = [];
			for (let x = tilePos1.x; x <= tilePos2.x; x++) {
				for (let y = tilePos1.y; y <= tilePos2.y; y++) {
					selectionArray.push({ x, y });
				}
			}
			this.changeSelection(selectionArray);
		},

		changeSelection(selection) {
			for (let selectedPosition of this.currentSelection) {
				this.setTileSelected(
					selectedPosition.x, selectedPosition.y, false);
			}
			this.splice("currentSelection", 0, this.currentSelection.length);

			for (let selectedPosition of selection) {
				this.setTileSelected(
					selectedPosition.x, selectedPosition.y, true);
				this.push("currentSelection", selectedPosition);
			}
		}
	};
</script>
