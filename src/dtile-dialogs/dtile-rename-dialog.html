<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../bower_components/paper-input/paper-input.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">

<dom-module id="dtile-rename-dialog">
	<template>
		<paper-dialog id="dialog">
			<h2>[[prompt]]</h2>
			<paper-input id="renameInput" label="Name" autofocus invalid="[[!_inputValid]]"
				error-message="[[errorMsg]]" required value="{{newName}}"></paper-input>
			<div class="buttons">
				<paper-button dialog-dismiss on-tap="_decline">Cancel</paper-button>
				<paper-button dialog-confirm disabled="[[!_renameInputValid]]"
					on-tap="_confirm">Rename</paper-button>
			</div>
		</paper-dialog>
	</template>

	<script>
		Polymer({
			is: "dtile-rename-dialog",

			properties: {
				prompt: String,
				errorMsg: String,

				_inputValid: {
					type: Boolean,
					computed: "_isInputValid(newName)"
				},

				newName: String
			},

			requestRename(prompt, errorMsg, validator) {
				this.prompt = prompt;
				this.errorMsg = errorMsg;

				this._validator = validator;

				return new Promise((resolve, reject) => {
					this.$.dialog.open();

					this._resolve = resolve;
					this._reject = reject;
				});
			},

			_confirm() {
				if (!this._inputValid) return;
				this._resolve(this.newName);
				this._reset();
			},

			_decline() {
				this._reject();
				this._reset();
			},

			_reset() {
				this.prompt = "";
				this.errorMsg = "";
				this.newName = "";
				this._validator = null;
				this._resolve = null;
				this._reject = null;
			},

			_isInputValid(input) {
				if (!input) return false;
				return this._validator(input);
			}
		});
	</script>
</dom-module>
