<script>
	const MMB_PAN_SENSITIVITY = 2;

	window.DTile = window.DTile || {};

	window.DTile.ScrollBehavior = {
		properties: {
			panX: {
				type: Number,
				value: 0,
				notify: true
			},
			panY: {
				type: Number,
				value: 0,
				notify: true
			},
			zoom: {
				type: Number,
				value: 0.15,
				notify: true
			}
		},

		listeners: {
			wheel: "_handleWheel",
			track: "_handleTrackPan"
		},

		pan(dx, dy) {
			// Add .001 to make sure invZoom !== 0
			const invZoom = this.zoom * -1 + 1.001;
			this.panX += dx * invZoom * 0.5;
			this.panY += dy * invZoom * 0.5;
		},

		_handleWheel(e) {
			e.preventDefault();
			e.stopPropagation();

			if (e.ctrlKey) {
				this.zoom = Math.max(0, Math.min(1, this.zoom + e.deltaY * -0.0003));
			} else {
				this.pan(e.deltaX, e.deltaY);
			}
		},

		_handleTrackPan(e) {
			if (e.detail.sourceEvent.button === 1 && e.detail.state === "track") {
				this.pan(e.detail.ddx * -MMB_PAN_SENSITIVITY, e.detail.ddy * -MMB_PAN_SENSITIVITY);
			}
		}
	};
</script>
