<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">

<link rel="import" href="../../bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="../../bower_components/paper-header-panel/paper-header-panel.html">
<link rel="import" href="../../bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../bower_components/paper-spinner/paper-spinner.html">

<link rel="import" href="../../bower_components/file-input/file-input.html">

<link rel="import" href="../dtile-three-renderer/dtile-three-renderer.html">

<dom-module id="dtile-app">
	<template>
		<style>
			:host {
				display: block;
			}

			#renderer {
				background: #303030;
			}
		</style>
		<paper-drawer-panel>
			<paper-header-panel drawer>
				<paper-button raised>
					<file-input id="mapFileInput" accept="application/json"
						extensions="[&quot;json&quot;]" max-files="1" on-change="updateMap">
					</file-input>
					Open Map
				</paper-button>
				<paper-spinner id="mapSpinner"></paper-spinner>
			</paper-header-panel>

			<paper-header-panel main class="flex">
				<paper-toolbar>
					<paper-icon-button icon="menu" paper-drawer-toggle></paper-icon-button>
					<span>DTile</span>
				</paper-toolbar>

				<dtile-three-renderer id="renderer" map="[[_map]]"></dtile-three-renderer>
			</paper-header-panel>
		</paper-drawer-panel>
	</template>

	<script src="../../node_modules/dtile-tilemap/out/js/build.js"></script>

	<script>
		/* globals dtileTilemap */
		Polymer({
			is: "dtile-app",

			properties: {
				_map: Object
			},

			updateMap() {
				const mapFile = this.$.mapFileInput.files[0];
				if (!mapFile) return;

				this.$.mapSpinner.active = true;

				const fileReader = new FileReader();

				fileReader.onload = () => {
					const mapObject = JSON.parse(fileReader.result);

					this._map = new dtileTilemap.TileMap(mapObject);
					this.$.mapSpinner.active = false;
				};

				fileReader.readAsText(mapFile);
			}
		});
	</script>
</dom-module>
