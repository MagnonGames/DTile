<link rel="import" href="../../bower_components/polymer/polymer.html">

<link rel="import" href="../../bower_components/app-route/app-location.html">
<link rel="import" href="../../bower_components/app-route/app-route.html">

<link rel="import" href="../../bower_components/iron-pages/iron-pages.html">

<link rel="import" href="../dtile-shell/dtile-shell.html">
<link rel="import" href="projects-view.html">

<dom-module id="dtile-app">
    <template>
        <app-location id="location" route="{{route}}"></app-location>
        <app-route
            route="{{route}}"
            pattern="/:pageName"
            data="{{pageData}}"
            tail="{{subroute}}">
        </app-route>
        <app-route
            route="{{subroute}}"
            pattern="/:content"
            data="{{pageContentData}}">
        </app-route>

        <dtile-shell>
            <iron-pages selected="[[page]]" attr-for-selected="page">
                <dtile-projects-view page="projects"></dtile-projects-view>
                <span page="project">Maps</span>
                <span page="tilesets">Tilesets</span>
                <span page="editor">Editor</span>
            </iron-pages>
        </dtile-shell>
    </template>
</dom-module>

<script>
    class DTileApp extends Polymer.Element {
        static get is() { return "dtile-app"; }

        static get properties() {
            return {
                route: String,
                page: {
                    type: String
                },

                pageData: Object,
                pageContentData: Object
            };
        }

        static get observers() {
            return [
                "_updatePage(pageData, pageContentData)"
            ];
        }

        _updatePage(pageData, pageContentData) {
            if (pageData.pageName === "") {
                // Index redirects to projects dashboard by replacing the current
                // state and updating the app-location element.
                history.replaceState(null, null, "/projects");
                window.dispatchEvent(new CustomEvent("location-changed"));
            } else {
                this.page = pageData.pageName;
            }
        }
    }

    customElements.define(DTileApp.is, DTileApp);
</script>
